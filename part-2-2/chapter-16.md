# 16장 IPv4 주소지정 개념과 이슈

IP는 수신자가 어디 있는지 모른다면 임무를 제대로 수향할 수 없다. 그렇기 때문에 IP의 가장 중요한 기능 중 하나는 **주소지정**이다.

16장에서는 IP 주소의 크기, 주소 공간의 개념, IP 주소에 일반적으로 쓰이는 표기법을 살펴본다. 

## IP 주소지정 개요와 기초

IP 주소의 기능

- 네트워크 인터페이스 식별: 장비와 네트워크 간의 <ins>*인터페이스를 유일하게 식별할 수 있도록 한다.*</ins> 데이터그램이 올바른 수신자에게 전달되는 것을 보장하기 위해 필요하다.
- IP 라우팅: IP 데이터그램의 출발지와 목적지가 동일 네트워크게 있지 않다면 그 데이터그램은 중간 시스템을 통해 간접적으로 전달돼야 한다. 이 절차를 라우팅 이라고 부른다. IP 주소는 데이터그램을 라우팅하는데 쓰이는 핵심 구성 요소다.

> 라우터가 IP 주소 내용을 통해 데이터그램의 처리 방향을 결정할 수 있도록 주소 지정 체계가 설계되었다. IP 주소와 연관된 숫자 (서브넷 마스크)는 이러한 기능을 지원한다.

### 장비별 IP 주소의 수

네트워크 계층에서 데이터를 받을 수 있는 모든 장비에는 IP 주소가 적어도 하나씩 있다.일부 특수 호스트는(라우터) 다중 인터페이스 방식으로 구성될 경우 하나 이상의 IP 주소를 가질 수 있다.  
리피터, 브리지, 스위치 같은 하위 수준 네트워크 연결 장비는 2계층(데이터 링크) 주소에 근거하여 트래픽을 통과시키기 때문에 IP 주소가 없어도 된다.

![16-1!](http://www.tcpipguide.com/free/diagrams/ipinterfaces.png)

### 주소의 유일성과 네트워크의 한정성

단일 인터네트워크에서 각 IP 주소는 유일해야 한다. (IPv6의 특수 애니캐스트 주소에는 예외가 있다)  
IP 주소는 네트워크 인터페이스를 나타내며 라우팅에 쓰이기 때문에, 특정 IP 주소는 네트워크 인터페이스가 연결된 네트워크에 한정된다. 만약 그 장비가 새로운 네트워크로 이동한다면 일반적으로 IP 주소도 함께 바뀌어야 한다.

### IP 주소와 데이터 링크 
계층 주소 비교

네트워크에서 장비 간에 데이터를 보내기 위해 필요한 정보는 MAC주소 밖에 없다. 반면 IP 주소는 데이터그램의 최종 목적지 정보만을 표현한다.

### 사설/공중 IP 네트워크 주소

- 사설 네트워크: 각 기관에서 모든 장비의 주소 할당을 제어한다. 서로 겹치지만 않는다면 그들은 자신이 원하는 숫자를 마음대로 선택할 수 있다.
- 공중 네트워크: 여러 기관들이 서로 중복하는 주소를 사용하지 않고 기관 간에 효과적인 라우팅을 하는 것을 보장하기 위한 방법이 필요하다. 인터넷에서는 이 문제를 해결하기 위해 공인 IP 등록/관리 기관을 만들었다. 지금은 이 문제를 해결하기 위해 사설 주소를 사용하는 네트워크가 공중 TCP/IP 네트워크에 접속할 수 있도록 하는 IP 네트워크 주소 변환과 (NAT, Network Address Translation) 같은 고급 기술이 나와있다.

### IP주소 설정과 주소지정 유형

IP주소는 정적 또는 동적 설정으로 구분될 수 있다.  
- 정적 설정: 각 장비는 고정 IP 주소를 수동으로 설정한다. 소규모 네트워크는 문제 없지만 대형 네트워크는 관리하기가 불가능하다.
- 동적 설정:IP 주소 변경이 자주 일어나는 상황의 대안으로 나온 설정으로 두 가지 호스트 설정 프로토콜인 BOOTP, DHCP가 탄생했다.

## IP 주소 크기, 주소 공간, 표기법

### IP 주소 크기와 2진 표기법

IP 주소는 32비트 이진수이다. 최하위 수준에서 컴퓨터는 항상 2진수로 작업하며 네트워킹 하드웨어와 소프트웨어도 마찬가지다. 주소의 서로 다른 비트에는 서로 다른 의미가 부여돼 있지만 주소 자체는 단지 32비트 2진수에 불과하다.  

- 2진수는 길고 복잡하기 때문에 사람들은 2진수를 잘 다루지 못한다. 
- 사람들이 편하게 처리하기 위해 8비트(옥텟)로 분리해서 관리한다.
- 8비트 옥텟을 좀 더 편하게 관리하기 위해 2자리의 16진수로 변환한다. 이것이 MAC 주소에서 사용하는 표기법이다.

### IP 주소 부점 10진 표기법

대부분의 사람들은 16진수도 다루기 어려워한다. 그래서 IP 주소는 일반적으로 8비트 옥텟을 10진수로 변환하고 마침표(.)로 구분한 형태로 표현한다. 227.82.157.177 이것을 부점 10진 표기법이라고 부른다.

![16-2!](http://www.tcpipguide.com/free/diagrams/iprep.png)

### IP 주소 공간

IP 주소의 크기는 32비트이기 때문에 이론적으로 주소 공간 2³², 즉 4,294,967,296이다. (42억 9496만 7296) 하지만 특수한 용도로 예약되어 있는 IP 주소들이 있다.

## IP기본 주소 구조와 주요 구성 요소

### 네트워크 ID와 호스트 ID

32비트의 IP주소는 내부적으로 두 개의 구송 요소를 가진 구조로 돼 있다.

- 네트워크 식별자: 맨 왼쪽 비트부터 시작하는 특정 수의 비트. 라우터가 IP 데이터그램을 라우팅하는데 쓰인다. **라우터는 IP 주소의 네트워크 부분을 본 뒤 목적지 IP 주소가 출발지 IP주소와 동일 네트워크에 있는지 판단한다.**
- 호스트 식별자: 네트워크 식별자를 제외한 나머지 비트는 호스트를 식별한다. 호스트 식별자는 **로컬 네트워크에서 데이터그램의 목적지를 찾는데 쓰인다.**
![16-3!](http://www.tcpipguide.com/free/diagrams/ipnethost.png)

### 네트워크 ID와 호스트 ID 구분 위치

IP 주소의 경우 네트워크 ID와 호스트 ID를 식벽하는데 쓰이는 비트를 구분하는 지점이 고정돼 있지 않다.
네트워크 ID와 호스트 ID를 32비트 주소로 표현할 때는 빈 부분에 0을 채우는 방법을 이용한다.

![16-4!](http://www.tcpipguide.com/free/diagrams/ipnethostmiddle.png)

## IP 주소지정 범주와 IP 주소 부속물

IP 주소 지정 방법의 종류

- **전통적 (클래스 단위) 주소 지정**: 네트워크 ID와 호스트 ID를 옥텟 단위로 구분한다. 클래스 구분 지점을 각 주소의 처음 몇 비트에 인코딩한다.
- **서브넷을 이용하는 클래스 단위 주소 지정**: 네트워크 ID와 호스트ID 두 단계로 IP 주소를 분리하는 것이 아니라 세 단계로 분리한다. 호스트 ID 일부 비트를 서브넷 식별자(서브넷 ID)로 이용한다. 네트워크 ID는 변하지 않는다. 서브넷 ID와 서브호스트 ID를 구분하는 점은 서브넷 마스크라는 32비트 숫자로 지정된다.(비트를 1로 지정한 부분은 서브넷 ID이고 비트를 0으로 지정한 부분이 서브호스트 ID를 나타낸다)
- **클래스 비사용 주소 지정**: 클래스를 전혀 사용하지 않는다. 네트워크 ID와 호스트 ID의 구분점은 클래스 단위 방법처럼 옥텟단위가 아니라 임의의 지점이 될 수 있다. 구분점은 네트워크 ID에 쓰이는 비트의 수를 주소 뒤에 붙여서 표시한다. (예: 227.82.157.177/27 - /27은 개념적으로 255.255.255.224라는 서브넷마스크와 동일하다)

### 서브넷 마스크와 기본 게이트웨이
클래스 단위 주소 지정 방법은 네트워크 ID와 호스트 ID를 구분하는 지점을 내포하고 있다.  
 그렇지만 서브넷 또는 클래스 비사용 주소지정 방법에는 주소를 완전히 해석하기 위해 <font color="orange">서브넷 마스크</font>(또는 슬래시 번호 표기)가 필요하다.  
이 숫자는 IP 주소의 부속물이며 일반적으로 주소 자체와 함께 표현된다. 왜냐하면 그 정보가 없으면 어디에서 네트워크 ID가 끝나고 호스트 ID가 시작 하는지 알 수 없기 때문이다.  
 IP 주소와 함께 표현되는 경우가 많은 또 다른 숫자는 기본 <font color="orange">게이트웨이 식별자</font>다. 가장 간단히 표현하면 이것은 특정 장비에 대한 기본 라우팅 기능을 제공하는 라우터의 IP 주소다. IP 네트워크의 한 장비는 로컬 IP 네트워크에 있지 않은 장비에게 데이터그램을 보내고 싶을 때 기본 게이트웨이에게 그 데이터그램을 전송한다. 그러면 게이트웨이는 라우팅 기능을 수행한다. 게이트웨이가 없다면 각 IP 장비는 라우팅 기능과 경로에 대한 정보를 가지고 있어야 하는데 이것은 비효율 적이다

## IP 주소의 수와 멀티호밍

어떤 장비가 인터네트워크에 하나 이상의 인터페이스로 연결돼 있다면 그 장비는 하나 이상의 IP 주소를 가질 것이다. 그 상황을 가장 쉽게 볼 수 있는 곳은 바로 라우터이다.  
호스트를 다중 인터페이스 구성으로 만드는 방법에는 두 가지가 있다.
- 두 개 이상의 인터페이스를 동일한 네트워크에 연결: 동일한 네트워크에서 **동일한 네트워크 ID**를 갖는 2개의 IP 주소를 갖는다.
- 두 개 이상의 서로 다른 네트워크에 인터페이스를 연결: **서로 다른 네트워크 ID**를 갖는다.

> 두 개 이상의 네트워크에 연결된 호스트는 라우터로 동작할 수 있다.

## IP 주소 관리와 할당 방법과 기관

![16-5!](http://www.tcpipguide.com/free/diagrams/ipmultihomed.png)

IP 인터네트워크에서 다중 인터페이스 장비. 이 인터네트워크는 상단에 있는 A와 하단에 있는 B의 두 LAN으로 구성된다. LAN A는 두 개의 IP 네트워크 인터페이스를 가지고 있는 다중 인터페이스 호스트를 가지고 있다. 이 두 LAN은 LAN 사이의 트래픽을 라우팅하도록 설정된 다중 인터페이스를 갖는 공유 서버를 통해 연결된다. 인터넷 연결이 오직 LAN A를 통해 이뤄지기 때문에 이 서버는 LAN B와 인터넷 사이의 모든 트래픽까지 처리한다.

인터넷도 거대한 IP 인터네트워크이기 때문에 전 세계적으로 수백만 개가 넘는 기관을 위해 이러한 조정 작업을 하는 기관이 필요하다. 인터넷의 IP 주소 할당 관리 작업은 원래 인터넷 할당 번호 관리 기관 (IANA, Internet Assigned Number Authority)에서 담당했다.  
1990년대 후반에 인터넷 이름/번호 할당 기관 (ICANN, Internet Corporation for Assigned Names and Numbers)이라는 새로운 기관이 탄생했다. 이제 ICANN은 IANA의 주소 할당 임무를 감독하며 DNS 네임 등록과 같은 다른 업무도 관리한다.